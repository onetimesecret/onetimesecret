# LLM-Optimized Test Cases: Secret Context Actor Roles
# Converted from: issue-2114-interaction-modes.md
# Schema version: 1.0.0

suite:
  id: secret-context-actor-roles
  name: Secret Context - Actor Roles
  feature: useSecretContext() composable
  issue: https://github.com/onetimesecret/onetimesecret/issues/2114
  tags: [vue, composable, auth, secret-reveal]

definitions:
  users:
    creator: &user_creator
      auth: logged_in
      user_type: creator
      description: User who created the secret being tested

    recipient_auth: &user_recipient_auth
      auth: logged_in
      user_type: other_account
      description: Different logged-in user viewing secret

    recipient_anon: &user_recipient_anon
      auth: incognito
      description: Anonymous visitor in incognito/private window

  fixtures:
    basic_secret: &fixture_secret
      type: secret
      props:
        content: "Test secret content"
        passphrase: null

tests:
  # -------------------------------------------------------------------------
  # OTS-2114-SC-001: CREATOR views own secret (pre-reveal)
  # -------------------------------------------------------------------------
  - id: OTS-2114-SC-001
    intent: |
      Creator viewing their own secret before revealing sees ownership warning
      and dashboard navigation (not signup CTA)

    setup:
      <<: *user_creator
      state:
        has_created_secret: true
      fixtures:
        - <<: *fixture_secret
          capture_as: secret_link

    target: "{{secret_link}}"  # Navigate to the secret confirmation page

    # No action needed - just observe the confirmation page
    action:
      type: none

    verify:
      - Yellow/amber warning banner is visible
      - Banner contains text like "You created this secret"
      - Header shows dashboard link (not signup CTA)
      - Secret content is NOT yet revealed (still shows confirmation)
      - selector: "[data-testid='owner-warning']"
        assertion: visible
      - selector: "[data-testid='header-dashboard-link']"
        assertion: exists

    postconditions:
      - Secret remains unviewed (one-time view NOT consumed)
      - Warning banner can be dismissed

    priority: high
    severity: major
    type: functional

    covers:
      - useSecretContext
      - actorRole === 'CREATOR'
      - uiConfig.headerAction === 'DASHBOARD_LINK'
      - pre-reveal state

    notes: |
      Tests the CREATOR actor role detection before the secret is revealed.
      The ownership warning prevents creators from accidentally consuming
      their own secret view.

  # -------------------------------------------------------------------------
  # OTS-2114-SC-002: CREATOR views own secret (post-reveal)
  # -------------------------------------------------------------------------
  - id: OTS-2114-SC-002
    intent: |
      Creator who reveals their own secret sees confirmation notice
      and has access to burn control

    setup:
      <<: *user_creator
      state:
        has_created_secret: true
      fixtures:
        - <<: *fixture_secret
          capture_as: secret_link

    target: "{{secret_link}}"

    action:
      type: click
      element: "View Secret button"  # Agent finds the reveal button

    verify:
      - Secret content is now visible
      - Brand-colored notice appears (not yellow warning)
      - Notice mentions viewing own secret
      - Burn button is visible and functional
      - selector: "[data-testid='secret-content']"
        assertion: visible
      - selector: "[data-testid='burn-control']"
        assertion: visible

    postconditions:
      - Secret is burned (one-time view consumed)
      - Page shows revealed state

    priority: high
    severity: major
    type: functional

    covers:
      - useSecretContext
      - actorRole === 'CREATOR'
      - uiConfig.showBurnControl === true
      - post-reveal state

    notes: |
      Tests CREATOR role after revealing. The burn control allows creators
      to immediately destroy the secret after viewing.

  # -------------------------------------------------------------------------
  # OTS-2114-SC-003: RECIPIENT_AUTH views someone else's secret
  # -------------------------------------------------------------------------
  - id: OTS-2114-SC-003
    intent: |
      Authenticated user viewing a secret they did NOT create sees no
      ownership warnings and no marketing upsells

    setup:
      auth: logged_in
      user_type: two_accounts  # Need Account A (creator) and Account B (viewer)
      state:
        secret_created_by: account_a
        viewing_as: account_b
      fixtures:
        - <<: *fixture_secret
          created_by: account_a
          capture_as: secret_link

    target: "{{secret_link}}"  # Account B navigates here

    action:
      type: none

    verify:
      - NO yellow owner warning banner displayed
      - NO marketing/capabilities upgrade prompt
      - Dashboard link visible in header (user is authenticated)
      - Secret confirmation page functions normally
      - selector: "[data-testid='owner-warning']"
        assertion: hidden
      - selector: "[data-testid='capabilities-upgrade']"
        assertion: hidden
      - selector: "[data-testid='header-dashboard-link']"
        assertion: exists

    postconditions:
      - Account B can reveal the secret normally

    priority: high
    severity: major
    type: functional

    covers:
      - useSecretContext
      - actorRole === 'RECIPIENT_AUTH'
      - uiConfig.showCapabilitiesUpgrade === false

    notes: |
      Tests the RECIPIENT_AUTH role - an authenticated user who is not the
      secret creator. They should see a clean interface without ownership
      warnings or marketing prompts.

  # -------------------------------------------------------------------------
  # OTS-2114-SC-004: RECIPIENT_ANON views secret without login
  # -------------------------------------------------------------------------
  - id: OTS-2114-SC-004
    intent: |
      Anonymous user viewing a secret sees marketing prompts and signup CTA
      but no burn control after reveal

    setup:
      <<: *user_recipient_anon
      state:
        secret_exists: true  # Created by any user beforehand
      fixtures:
        - <<: *fixture_secret
          capture_as: secret_link

    target: "{{secret_link}}"

    action:
      type: click
      element: "View Secret button"

    verify:
      # Pre-reveal observations
      - NO owner warning banner (user is not creator)
      - Marketing/capabilities upgrade prompt is visible
      - Signup CTA in header (not dashboard link)
      # Post-reveal observations
      - Secret content revealed successfully
      - NO burn control visible (anonymous users cannot burn)
      - selector: "[data-testid='owner-warning']"
        assertion: hidden
      - selector: "[data-testid='capabilities-upgrade']"
        assertion: visible
      - selector: "[data-testid='header-signup-cta']"
        assertion: exists
      - selector: "[data-testid='burn-control']"
        assertion: hidden

    postconditions:
      - Anonymous user viewed secret successfully
      - Marketing messaging was displayed

    priority: high
    severity: major
    type: functional

    covers:
      - useSecretContext
      - actorRole === 'RECIPIENT_ANON'
      - uiConfig.showCapabilitiesUpgrade === true
      - uiConfig.headerAction === 'SIGNUP_CTA'
      - uiConfig.showBurnControl === false

    notes: |
      Tests the RECIPIENT_ANON role - unauthenticated visitors. They see
      marketing prompts encouraging signup but cannot burn secrets.
