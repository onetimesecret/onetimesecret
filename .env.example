# Onetime Secret - Environment Variables (updated 2026-02-18)
#
# Quick start:
#
#   $ cp -np .env.example .env
#   $ rake ots:init             # generates SECRET, derives child keys
#   $ docker compose up         # or: bundle exec puma -C etc/puma.rb

# SECRET is the single root secret. All other secret-material variables
# (SESSION_SECRET, ARGON2_SECRET, FEDERATION_HMAC_SECRET) are
# derived from it by `rake ots:init` using HKDF (RFC 5869).
# Back up SECRET â€” it is the only value needed for disaster recovery.
SECRET=
SESSION_SECRET=
HMAC_SECRET=

# Secret link verification (Familia::VerifiableIdentifier)
# Used to generate secret/receipt keys; allows high-confidence verification
# that a link was generated by this instance
VERIFIABLE_ID_HMAC_SECRET=

# --- Derived secrets (written by rake ots:init) ---
# Do not set these manually; they are deterministically derived from SECRET.
# Run `DERIVE=1 rake ots:init` to regenerate after changing SECRET.
#SESSION_SECRET=
# Argon2 pepper for password hashing (full auth mode only).
# Folded into every password hash via Rodauth's argon2_secret.
# Must be consistent across all code paths that verify passwords
# (Rodauth login, email change, account deletion, etc.).
# WARNING: Changing this value invalidates ALL existing password hashes.
# See: apps/web/auth/config/features/argon2.rb
#ARGON2_SECRET=
# Cross-region subscription federation (must be identical across all regions)
#FEDERATION_HMAC_SECRET=


# Connections
REDIS_URL='redis://maindb:5212/0?timeout=5'
AUTH_DATABASE_URL=postgresql://onetime_user:plop9@authdb/onetime_auth
AUTH_DATABASE_URL_MIGRATIONS=postgresql://onetime_migrator:plop9@authdb/onetime_auth
RABBITMQ_URL=amqp://${RABBITMQ_USER:-guest}:${RABBITMQ_PASS:-guest}@mqhost:5672/dev


SMTP_HOST=
SMTP_PORT=
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_AUTH=login
SMTP_TLS=true



# Core Settings
HOST="localhost:${PORT:-3000}"
SSL="true"
COLONEL=

# Secret TTL Configuration
#
# These settings control the time-to-live (TTL) limits for secrets.
#
# TTL_OPTIONS: Available TTL choices for users (space-separated seconds)
# Example: TTL_OPTIONS='300 3600 86400 604800 2592000'
#          (5 min, 1 hour, 1 day, 7 days, 30 days)
#TTL_OPTIONS=
#
# DEFAULT_TTL: Default TTL when not specified (in seconds)
#DEFAULT_TTL=604800
#
# PLAN_TTL_ANONYMOUS: Maximum TTL for anonymous/free tier users (seconds)
# This matches the environment variable from PR #2393 for upgrade continuity.
# Default: 604800 (7 days). Maximum allowed: 31536000 (365 days).
# Values are clamped between 0 and 365 days. Invalid values use the default.
#
# For Docker deployments wanting 30-day TTL:
#   TTL_OPTIONS='604800 1209600 2592000'
#   PLAN_TTL_ANONYMOUS=2592000
#
# @see https://github.com/onetimesecret/onetimesecret/issues/2390
#PLAN_TTL_ANONYMOUS=604800

#
# ONLY FLAGS AND OPTIONAL SETTINGS BEYOND THIS POINT
#

SSL=true
STDOUT_SYNC=false
ONETIME_DEBUG=false
RACK_ENV=development
NODE_ENV=development

DEFAULT_LOG_LEVEL=debug

# Logging Configuration
# Set to 'false' to disable request logging
LOG_HTTP_REQUESTS=true
LOG_HTTP_REQUESTS_LEVEL=debug
LOG_HTTP_CAPTURE=debug

# Job System (RabbitMQ)
JOBS_ENABLED=true
RABBITMQ_URL=amqp://guest:guest@localhost:5672
RABBITMQ_VHOST=/
RABBITMQ_USER=guest
RABBITMQ_PASS=guest
SNEAKERS_PID_PATH=tmp/pids/sneakers.pid
SCHEDULER_PID_PATH=tmp/pids/scheduler.pid

# Authentication settings
AUTHENTICATION_MODE=full
AUTH_ENABLED=true
AUTH_SIGNUP=true
AUTH_SIGNIN=true
AUTH_AUTOVERIFY=false

# Only available in full mode
AUTH_EMAIL_AUTH_ENABLED=true
AUTH_LOCKOUT_ENABLED=true
AUTH_MFA_ENABLED=false
AUTH_WEBAUTHN_ENABLED=false
AUTH_PASSWORD_REQUIREMENTS_ENABLED=true
AUTH_ACTIVE_SESSIONS_ENABLED=true
AUTH_VERIFY_ACCOUNT_ENABLED=true

AUTH_SSO_ENABLED=false
SSO_DISPLAY_NAME=
OIDC_ISSUER=
OIDC_CLIENT_ID=
OIDC_CLIENT_SECRET=
OIDC_REDIRECT_URI=

# Email settings
EMAILER_MODE=smtp
EMAILER_REGION=
FROM_EMAIL=secure@onetimesecret.com
FROMEMAIL=secure@onetimesecret.com
FROMNAME=secure@onetimesecret.com
FROM=secure@onetimesecret.com

VERIFIER_EMAIL=secure@onetimesecret.com
VERIFIER_DOMAIN=onetimesecret.com

# One of: DefaultLogo.vue, LegacyLogo.vue, OnetimeSecretLogo.vue
#LOGO_URL=OnetimeSecretLogo.vue

# Footer Links
FOOTER_LINKS=true
PRICING_URL=/pricing
TERMS_URL=https://onetimesecret.com/terms
PRIVACY_URL=https://onetimesecret.com/privacy
STATUS_URL=https://status.onetimesecret.com/
ABOUT_URL=https://onetimesecret.com/about
CONTACT_URL=/feedback

# Feature flags
REGIONS_ENABLED=true
JURISDICTION=CA
DOMAINS_ENABLED=true
DEFAULT_DOMAIN=
I18N_ENABLED=true
I18N_DEFAULT_LOCALE=en
INCOMING_ENABLED=true
INCOMING_RECIPIENT_1=delbo@solutious.com

# Monitoring and Diagnostics
DIAGNOSTICS_ENABLED=false
SENTRY_DSN_BACKEND=
SENTRY_DSN_FRONTEND=
SENTRY_VUE_TRACK_COMPONENTS=true
SENTRY_SAMPLE_RATE=
SENTRY_MAX_BREADCRUMBS=
SENTRY_LOG_ERRORS=true
HEADER_PREFIX=ONETIME_

# Homepage Mode
# Controls which homepage experience to show based on IP address or headers
# Mode: 'internal' (full homepage) or 'external' (restricted homepage) or blank (default)
UI_HOMEPAGE_MODE=
# Comma-separated list of CIDR ranges (e.g., "10.0.0.0/8,192.168.0.0/16")
UI_HOMEPAGE_MATCHING_CIDRS=
# HTTP header name to check as fallback (default: O-Homepage-Mode)
UI_HOMEPAGE_MODE_HEADER=
# Default mode to apply when IP doesn't match CIDRs: 'internal', 'external', or blank (nil)
UI_HOMEPAGE_DEFAULT_MODE=
# Number of trusted proxies (0=direct, 1=single proxy, 2+=multiple proxies)
UI_HOMEPAGE_TRUSTED_PROXY_DEPTH=
# Which header to use for IP: X-Forwarded-For, Forwarded, or Both
UI_HOMEPAGE_TRUSTED_IP_HEADER=

# Domain validation and certificate management
# Options: passthrough (default), approximated, caddy_on_demand
DOMAINS_VALIDATION_STRATEGY=
APPROXIMATED_API_KEY=
APPROXIMATED_PROXY_IP=
APPROXIMATED_PROXY_HOST=
APPROXIMATED_PROXY_NAME=
APPROXIMATED_VHOST_TARGET=

# List variables that should be stored as podman secrets
SECRET_VARIABLE_NAMES=STRIPE_API_KEY,SECRET,SESSION_SECRET,HMAC_SECRET,SMTP_PASSWORD,STRIPE_WEBHOOK_SIGNING_SECRET,VERIFIABLE_ID_HMAC_SECRET,FEDERATION_HMAC_SECRET

# Stripe
STRIPE_API_KEY=
STRIPE_WEBHOOK_SIGNING_SECRET=
PUBLIC_STRIPE_API_KEY=



#
# ### Development settings ###
#

# FRONTEND_HOST=https://dev.onetime.dev
# VITE_API_BASE_URL=dev.onetime.dev

# So that when using the stdlib debugger to add a breakpoint,
# we can interact using IRB interface instead of the plain
# debugger one which doesn't have autocomplete etc.
RUBY_DEBUG_IRB_CONSOLE=true

VITE_ADDITIONAL_SERVER_ALLOWED_HOSTS=.onetime.dev,.afb.pet

WORKER_HEARTBEAT_INTERVAL=600   # Every 10 min instead of 5

#RUBYOPT="--enable-frozen-string-literal"
#RUBYOPT="${RUBYOPT} --yjit-stats"
RUBY_YJIT_ENABLE=1
