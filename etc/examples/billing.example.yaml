# etc/examples/billing.example.yaml
---
# Onetime Secret - Unified Billing Configuration Example
#
# This file combines billing configuration and plan catalog in a flat structure.
# Copy to etc/billing.yaml and customize for your deployment.
#
# Schema Version: 1.0

schema_version: "1.0"
app_identifier: "onetimesecret"  # Used in Stripe metadata['app'] matching

# It doesn't make sense to have an enabled flag for turning the billing functionality
# on. If the billing.yaml config file exists, we assume it is enabled. Ah, but what if
# you want to turn off billing but not delete the file. That's what this flag is for.
enabled: <%= ENV['BILLING_ENABLED'] != 'false' %>
stripe_key: <%= ENV['STRIPE_API_KEY'] || 'nostripekey' %>
webhook_signing_secret: <%= ENV['STRIPE_WEBHOOK_SIGNING_SECRET'] || 'nosigningsecret' %>
stripe_api_version: "2025-11-17.clover"

# Entitlement Definitions
# Defines what features/permissions exist in the billing system.
# Plans reference these entitlements by ID.
#
# Each entitlement has:
# - category: Logical grouping (core, collaboration, infrastructure, branding, advanced, support)
# - description: Developer-facing description of the entitlement
# - display_name: i18n key reference for frontend labels (see src/locales/en/account-billing.json)
#
# Categories: core, collaboration, infrastructure, branding, advanced, support
entitlements:
  create_secrets:
    category: core
    description: Can create basic secrets
    display_name: web.billing.overview.entitlements.create_secrets

  view_receipt:
    category: core
    description: Can view secret metadata
    display_name: web.billing.overview.entitlements.view_receipt

  api_access:
    category: infrastructure
    description: Can use REST API endpoints
    display_name: web.billing.overview.entitlements.api_access

  custom_domains:
    category: infrastructure
    description: Can configure custom domains
    display_name: web.billing.overview.entitlements.custom_domains

  extended_default_expiration:
    category: core
    description: Extended secret expiration (30 days default)
    display_name: web.billing.overview.entitlements.extended_default_expiration

  custom_branding:
    category: branding
    description: Custom branding and styling
    display_name: web.billing.overview.entitlements.custom_branding

  homepage_secrets:
    category: branding
    description: Branded homepage for custom domains
    display_name: web.billing.overview.entitlements.homepage_secrets

  manage_teams:
    category: collaboration
    description: Can create and manage teams
    display_name: web.billing.overview.entitlements.manage_teams

  manage_members:
    category: collaboration
    description: Can add and manage team members
    display_name: web.billing.overview.entitlements.manage_members

  custom_privacy_defaults:
    category: advanced
    description: Custom privacy default settings
    display_name: web.billing.overview.entitlements.custom_privacy_defaults

  incoming_secrets:
    category: core
    description: Can receive secrets from others
    display_name: web.billing.overview.entitlements.incoming_secrets

  custom_mail_defaults:
    category: infrastructure
    description: Custom mail and DKIM settings
    display_name: web.billing.overview.entitlements.custom_mail_defaults

  manage_orgs:
    category: collaboration
    description: Can create and manage organizations
    display_name: web.billing.overview.entitlements.manage_orgs

  audit_logs:
    category: advanced
    description: Access to audit log features
    display_name: web.billing.overview.entitlements.audit_logs

  sso:
    category: advanced
    description: Single sign-on integration
    display_name: web.billing.overview.entitlements.sso

  priority_support:
    category: support
    description: Priority customer support
    display_name: web.billing.overview.entitlements.priority_support

  sla:
    category: support
    description: Service level agreement
    display_name: web.billing.overview.entitlements.sla

# Plan Definitions
#
# All plans are synced to Stripe via `bin/ots billing catalog push`, including
# free tier. Free plans in Stripe enable:
# - Downgrade flows (manual or after subscription cancellation)
# - Targeted free/discounted plans for non-profits
# - Consistent plan metadata across all tiers
#
# Free tier plans typically have `prices: []` (no Stripe prices needed).
plans:
  # Free Tier - No subscription required
  free_v1:
    name: "Free"
    tier: free
    tenancy: multi
    region: global
    display_order: 0
    show_on_plans_page: true
    description: "Default tier for all users without subscription"

    entitlements:
      - create_secrets
      - view_receipt
      - api_access

    limits:
      teams: 0
      organizations: 5
      members_per_team: 1
      custom_domains: 0
      secret_lifetime: 604800  # 7 days in seconds
      secrets_per_day: null

    prices: []  # Free tier has no prices

  # Example Paid Tier
  pro_v1:
    name: "Pro"
    tier: single_account
    tenancy: multi
    region: global
    display_order: 10
    show_on_plans_page: true
    description: "For individuals needing more features"

    entitlements:
      - create_secrets
      - view_receipt
      - api_access
      - custom_domains
      - extended_default_expiration

    limits:
      teams: 0
      organizations: 10
      members_per_team: 1
      custom_domains: 1
      secret_lifetime: 2592000  # 30 days in seconds
      secrets_per_day: -1  # unlimited

    prices:
      - interval: month
        amount: 900  # $9.00 USD
        currency: usd
      - interval: year
        amount: 9000  # $90.00 USD
        currency: usd
