# Homepage Mode Configuration Examples
#
# This file demonstrates different configuration patterns for the Homepage Mode feature.
# The feature allows you to show different homepage experiences based on IP address
# (CIDR ranges) or request headers.
#
# Copy and adapt these examples to your etc/config.yaml file.

# =============================================================================
# Example 1: Internal Mode for Office Networks (Behind Reverse Proxy)
# =============================================================================
# Show full homepage with secret creation for users on trusted networks
#
# Use case: Employees and partners on known networks get full access
# IMPORTANT: Set trusted_proxy_depth > 0 when behind reverse proxy
#
site:
  interface:
    ui:
      homepage:
        mode: internal
        matching_cidrs:
          - "10.0.0.0/8"         # Private network (Class A)
          - "192.168.0.0/16"     # Local network (Class C)
          - "203.0.113.0/24"     # Office public IP range (example)
          - "198.51.100.0/24"    # Partner network (example)
        request_header: "O-Homepage-Mode"
        trusted_proxy_depth: 1   # Trust single reverse proxy (nginx, Caddy, etc.)

# =============================================================================
# Example 2: External Mode for Public Access (Behind Reverse Proxy)
# =============================================================================
# Show restricted homepage without secret creation for external visitors
#
# Use case: Public internet users see information-only homepage
#
site:
  interface:
    ui:
      homepage:
        mode: external
        matching_cidrs:
          - "203.0.113.0/24"     # Specific external network to restrict
        request_header: "O-Homepage-Mode"
        trusted_proxy_depth: 1   # Trust single reverse proxy

# =============================================================================
# Example 3: Direct Connection (No Reverse Proxy)
# =============================================================================
# Application receives connections directly, not through a proxy
#
# Use case: Development environment or direct internet exposure
# WARNING: Only use trusted_proxy_depth: 0 when NOT behind a reverse proxy
#
site:
  interface:
    ui:
      homepage:
        mode: internal
        matching_cidrs:
          - "10.0.0.0/8"
          - "192.168.0.0/16"
        request_header: "O-Homepage-Mode"
        trusted_proxy_depth: 0   # NOT behind proxy - use direct connection IP

# =============================================================================
# Example 4: Behind Load Balancer AND Reverse Proxy
# =============================================================================
# Application behind multiple proxy layers
#
# Use case: Internet → CDN/Load Balancer → Reverse Proxy → Application
#
# X-Forwarded-For: client_ip, load_balancer_ip, reverse_proxy_ip
#                   ↑         ↑                  ↑
#                   Want this  depth=2           depth=1
#
site:
  interface:
    ui:
      homepage:
        mode: internal
        matching_cidrs:
          - "10.0.0.0/8"
          - "192.168.0.0/16"
        request_header: "O-Homepage-Mode"
        trusted_proxy_depth: 2   # Trust 2 proxy layers (CDN + reverse proxy)

# =============================================================================
# Example 5: IPv6 Networks (Behind Reverse Proxy)
# =============================================================================
# Support IPv6 CIDR ranges with /48 minimum prefix for privacy
#
site:
  interface:
    ui:
      homepage:
        mode: internal
        matching_cidrs:
          - "2001:db8::/48"      # IPv6 network (minimum /48)
          - "10.0.0.0/8"         # IPv4 network (minimum /24)
        request_header: "O-Homepage-Mode"
        trusted_proxy_depth: 1   # Trust single reverse proxy

# =============================================================================
# Mode Behavior Summary
# =============================================================================
#
# internal mode:
#   - Full homepage with secret creation form
#   - All features enabled
#   - Intended for trusted users/networks
#
# external mode:
#   - Restricted homepage without secret creation
#   - Information/marketing content only
#   - Sign-in/sign-up options visible
#   - Intended for public visitors
#
# no mode (nil):
#   - Default homepage behavior
#   - Based on authentication settings
#
# =============================================================================
# Detection Priority
# =============================================================================
#
# 1. CIDR Matching (Primary)
#    - Cannot be spoofed
#    - Most secure method
#    - Checked first
#
# 2. Request Header (Fallback)
#    - Header: O-Homepage-Mode
#    - Value must match configured mode
#    - Only checked if CIDR doesn't match
#
# 3. No Match
#    - Shows default homepage
#    - No mode restrictions applied
#
# =============================================================================
# Privacy Enforcement
# =============================================================================
#
# CIDR blocks are validated for privacy:
#   - IPv4: Minimum /24 prefix (max 254 hosts)
#   - IPv6: Minimum /48 prefix
#   - Prevents targeting individual IPs
#   - Invalid CIDRs are logged and rejected
#
# =============================================================================
# trusted_proxy_depth Explained
# =============================================================================
#
# ⚠️  CRITICAL: This setting determines which IP address is used for CIDR matching
#
# How X-Forwarded-For Works:
#   Client → Proxy1 → Proxy2 → App
#
#   X-Forwarded-For header: "client_ip, proxy1_ip, proxy2_ip"
#                            [0]       [1]        [2]
#                            [-3]      [-2]       [-1]
#
# trusted_proxy_depth Values:
#   0 = Don't trust X-Forwarded-For, use REMOTE_ADDR
#       → Use when: App receives connections directly (no proxy)
#       → Result: Uses the direct connection IP (usually your proxy's IP)
#       → ⚠️  WRONG for most production deployments behind reverse proxy!
#
#   1 = Trust 1 proxy, use rightmost IP from X-Forwarded-For (index -1)
#       → Use when: Single reverse proxy (nginx, Caddy, Apache)
#       → Result: Uses the last IP in the chain (closest to app)
#       → ✓ CORRECT for standard reverse proxy setups
#
#   2 = Trust 2 proxies, use 2nd from right (index -2)
#       → Use when: Load balancer → Reverse proxy → App
#       → Result: Uses second-to-last IP (bypasses both trusted proxies)
#       → ✓ CORRECT for CDN/load balancer + reverse proxy setups
#
# Common Mistake:
#   ❌ Setting trusted_proxy_depth: 0 when behind a reverse proxy
#   ✓  Set trusted_proxy_depth: 1 for standard nginx/Caddy deployments
#
# Security Requirements:
#   - Only trust proxies you control
#   - Ensure proxies strip/override client X-Forwarded-For headers
#   - Block direct access to application (firewall rules)
#   - Proxies must append their own IP to X-Forwarded-For
#
# =============================================================================
# Environment Variables
# =============================================================================
#
# You can also configure via environment variables:
#
#   UI_HOMEPAGE_MODE=internal
#   UI_HOMEPAGE_MATCHING_CIDRS="10.0.0.0/8,192.168.0.0/16"
#   UI_HOMEPAGE_REQUEST_HEADER="O-Homepage-Mode"
#   UI_HOMEPAGE_TRUSTED_PROXY_DEPTH=1   # Note: 1 for most deployments, not 0!
