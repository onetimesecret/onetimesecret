# spec/auth.test.yaml
#
# Authentication Configuration for OneTimeSecret - TEST ENVIRONMENT
# Controls the authentication mode and related settings
---
# Authentication mode: 'simple' (Redis-only) or 'full' (requires SQL db)
# Can be overridden with AUTHENTICATION_MODE environment variable
mode: full

# Shared session configuration (both modes)
session:
  secret: 'test-session-secret-do-not-use-in-production-minimum-64-characters-long'
  redis_url: 'redis://127.0.0.1:2121/0'
  expire_after: 86400 # 24 hours
  key: 'onetime.session' # Unified cookie name
  secure: false # Must be false for Rack::Test (uses HTTP, not HTTPS)
  httponly: true
  same_site: strict
  redis_prefix: 'session'

# Simple mode settings (Redis-only authentication)
simple:
  password_hash_cost: 12
  session_timeout: 86400 # 24 hours

# Full mode settings (Rodauth-based application)
full:
  # Database connection for Full mode
  # Uses in-memory SQLite for tests to avoid file persistence issues
  database_url: "<%= ENV['AUTH_DATABASE_URL'] || 'sqlite::memory:' %>"

  # Full mode features (for reference)
  features:
    - login
    - logout
    - create_account
    - close_account
    - change_password
    - reset_password
    - remember          # "Remember me" functionality
    - verify_account    # Email verification (optional)
    - lockout           # Brute force protection
    - active_sessions   # Session tracking
    - otp               # TOTP MFA (optional)
    - recovery_codes    # MFA backup codes (optional)

  # Security settings
  security:
    password_minimum_length: 8
    max_invalid_logins: 5
    lockout_expiration: 3600 # 1 hour
    session_expire_after: 86400 # 24 hours
    require_email_confirmation: false # Set to true when email is configured
